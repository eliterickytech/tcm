<link rel="stylesheet" href="../../../../wwwroot/css/style.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.css" />
<link rel="stylesheet" href="../../../../wwwroot/js/jquery/jquery.js">
<script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="../../../../wwwroot/js/jquery-ajax-unobtrusive/jquery.unobtrusive-ajax.js"></script>
<script src="../../../../wwwroot/js/sweetalert2/sweetalert2.all.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<div class="container">
    <table id="Upload" style="width:100%" border="1">
        <tr>
            <td class="title_collectible" style="width:50%;">
                <h2>Add collection</h2>
            </td>
            <td style="width:50%;">
                <ul id="nav" class="nav float-end">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-default"
                           href="#" id="bannerTypeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Page
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="bannerTypeDropdown">
                            <li><a class="dropdown-item text-weight-bold text-default" href="#" data-collectiontypeid="@((int)TCM.Services.Model.Enum.CollectionType.SinglePage)">1x1</a></li>
                            <li><a class="dropdown-item text-weight-bold text-default" href="#" data-collectiontypeid="@((int)TCM.Services.Model.Enum.CollectionType.Grid2x2)">2x2</a></li>
                            <li><a class="dropdown-item text-weight-bold text-default" href="#" data-collectiontypeid="@((int)TCM.Services.Model.Enum.CollectionType.Grid3x3)">3x3</a></li>
                        </ul>
                    </li>
                </ul>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="file" class="form-control mb-3" name="imagemInput" id="imagemInput" required">

                <input type="hidden" id="collectiontypeid" name="collectiontypeid" value="1" />
            </td>
        </tr>
        <tr>
            <td colspan="2" style="align-items:center" align="center">
                <div id="resizeImage" class="area_collection_single"></div>
            </td>
        </tr>
        <tr>
            <td style="width:80%" class="area_next">
                <input type="text" class="collection_next" id="collectionName" name="collectionName"
                       placeholder="Tap to give your collection a name*" required />

            </td>
            <td style="align-items:flex-end">
                <input type="button" value="NEXT" id="next" class="next operador">
            </td>
        </tr>
    </table>
    <table id="containerSingle" width="100%" style="display: none">
        <tr>
            <td>
                <table style="width:100%;" border="1">
                    <tr>
                        <td colspan="2" class="text-default text-weight-bold">Miniatura*</td>
                    </tr>
                    <tr>
                        <td style="vertical-align:top" colspan="2">                            

                            <table style="width:100%" border="1">
                                <tr>
                                    <td rowspan="2" valign="top">
                                        <div id="imageMini" class="box_image"></div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <table  style="width:100%; border: solid">
                                            <tr>
                                                <td colspan="1" >
                                                    <input type="text" class="collection_next" name="miniature" id="miniature">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="width:40%; vertical-align:top">
                                                    <input class="form-check-input" checked type="radio" name="available" id="available" value="1" required>

                                                    <label class="form-check-label text-default" for="available">
                                                        Available now
                                                    </label>
                                                </td>
                                                <td>
                                                    <input class="form-check-input" type="radio" name="available" id="scheduled" value="2" required>
                                                    <label class="form-check-label text-default" for="scheduled">
                                                        Scheduled
                                                    </label>
                                                    <input type="text" class="collection_next" name="scheduled" id="scheduled" placeholder="dd/mm/yyyy hh:mm" style="border:none">

                                                </td>
                                            </tr>
                                        </table>                                  

                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <p class="text-default text-weight-bold">1 Piece title*</p>
                        </td>
                    </tr>
                    <tr>
                        <td style="vertical-align:top" colspan="2">
                            <table style="width:100%" border="1">
                                <tr>
                                    <td>
                                        <div id="imagePiece" alt="Imagem" class="box_image" />
                                    </td>
                                    <td style="width:90%">
                                        <input value="testeset" class="collection_next" type="text" id="piece1" name="piece1" style="height: 7.39%;">
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" style="align-items:flex-end">
                            <input type="submit" value="SAVE COLLECTION" class="next">
                        </td>
                    </tr>
                </table>

            </td>
        </tr>
    </table>
</div>

<script>
    (() => {
        'use strict'

        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        const forms = document.querySelectorAll('.needs-validation')

        // Loop over them and prevent submission
        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }

                form.classList.add('was-validated')
            }, false)
        })
    })()

    $(document).ready(function () {
        $("#scheduled").mask("00/00/0000 00:00");

        $(document).on('ajaxSuccess', function (event, xhr, settings) {
            if (settings.url.indexOf("ProcessForm") > -1) {
                var response = xhr.responseJSON;
                if (response && response.isOK === false) {
                    $('#result').html('<div class="alert alert-danger">' + response.errors + '</div>');
                }
                else {

                }
            }
        });

        $("#next").click(function (event) {
            event.preventDefault();
            var collectionTypeId = $("#collectiontypeid").val();

            if (collectionTypeId == 1) {
                $("#containerSingle").show();
            } else if (collectionTypeId == 2) {
                $("#container2x2").show();
            } else if (collectionTypeId == 3) {
                $("#container3x3").show();
            }

            $("Upload").css("display:none");
        });

        $(".dropdown-item").click(function (event) {
            event.preventDefault();

            var collectionTypeId = $(this).data("collectiontypeid");

            if (collectionTypeId == 1) {
                $("#containerSingle").show();
            } else if (collectionTypeId == 2) {
                $("#container2x2").show();
            } else if (collectionTypeId == 3) {
                $("#container3x3").show();
            }
        });


    });


    $("#imagemInput").change(function () {
        var inputFile = this;
        if (inputFile.files && inputFile.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                var imagePreview = $("#resizeImage");
                imagePreview.empty();
                var imageMiniature = $("#imageMini");
                imageMiniature.empty();

                var imgMini = $("<img>");
                imgMini.attr("src", e.target.result);
                imgMini.css("width", "60px");
                imgMini.css("height", "60px");

                var img = $("<img>");
                img.attr("src", e.target.result);
                img.css("width", "350px");
                img.css("height", "350px");

                imagePreview.append(img);
                imageMiniature.append(imgMini);
            };

            reader.readAsDataURL(inputFile.files[0]);
        }
    });


</script>
